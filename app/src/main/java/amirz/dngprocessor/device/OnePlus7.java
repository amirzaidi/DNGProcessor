package amirz.dngprocessor.device;

import android.util.Rational;
import android.util.SparseArray;

import amirz.dngprocessor.params.SensorParams;
import amirz.dngprocessor.parser.TIFFTag;

public class OnePlus7 extends Generic {
    private static final float[] CC1 = new float[] {
            1f, 0f, 0.2f, // Low=Remove Pink, High=Invert Pink | Low=Remove Red, High=Cyberpunk
            0.2f, 1f, 0.3f, // Low=Purple/Yellow, High=Magenta/Green | Low=Cyan, High=Violet/Green
            0.1f, 0f, 1f, // | Low=Blue->Bright, High=Blue->Green
    };

    private static final float[] CC2 = CC1;

    @Override
    public boolean isModel(String model) {
        return model.startsWith("GM19") || model.startsWith("HD19");
    }

    @Override
    public void sensorCorrection(SparseArray<TIFFTag> tags, SensorParams sensor) {
        //sensor.calibrationTransform1 = CC1;
        //sensor.calibrationTransform2 = CC2;

        Rational r = sensor.neutralColorPoint[0];
        sensor.neutralColorPoint[0] = new Rational(
                r.getNumerator() * 29,
                r.getDenominator() * 30
        );

        Rational b = sensor.neutralColorPoint[2];
        sensor.neutralColorPoint[2] = new Rational(
                b.getNumerator() * 51,
                b.getDenominator() * 50
        );

        /*
        sensor.colorMatrix1 = new float[] {
                86f / 128f, -10f / 128f, -13f / 128f,
                -52f / 128f, 167f / 128f, 9f / 128f,
                -9f / 128f, 30f / 128f, 48f / 128f,
        };
        sensor.colorMatrix2 = new float[] {
                137f / 128f, -37f / 128f, -14f / 128f,
                -66f / 128f, 190f / 128f, 31f / 128f,
                -4f / 128f, 14f / 128f, 81f / 128f,
        };
        sensor.forwardTransform1 = new float[] {
                94f / 128f, 8f / 128f, 21f / 128f,
                30f / 128f, 102f / 128f, -5f / 128f,
                -1f / 128f, -45f / 128f, 152f / 128f,
        };
        sensor.forwardTransform2 = new float[] {
                94f / 128f, 8f / 128f, 21f / 128f,
                30f / 128f, 102f / 128f, -5f / 128f,
                -1f / 128f, -45f / 128f, 152f / 128f,
        };
        */

        if (sensor.gainMap == null) {
            sensor.gainMap = new float[] {
                    2.9589844f, 3.258789f, 3.258789f, 3.4033203f, 2.6542969f, 2.8515625f, 2.8515625f, 2.9951172f, 2.4238281f, 2.5488281f, 2.5488281f, 2.6455078f, 2.2363281f, 2.3154297f, 2.3154297f, 2.375f, 2.0683594f, 2.1699219f, 2.1699219f, 2.2138672f, 1.9375f, 2.0576172f, 2.0576172f, 2.1083984f, 1.8408203f, 1.9326172f, 1.9326172f, 1.9833984f, 1.8017578f, 1.8398438f, 1.8398438f, 1.8955078f, 1.7333984f, 1.8271484f, 1.8271484f, 1.8642578f, 1.7607422f, 1.8476562f, 1.8476562f, 1.9101562f, 1.828125f, 1.9179688f, 1.9179688f, 1.9375f, 1.9072266f, 2.0126953f, 2.0126953f, 2.0898438f, 2.0039062f, 2.1416016f, 2.1416016f, 2.2509766f, 2.1328125f, 2.3066406f, 2.3066406f, 2.4082031f, 2.319336f, 2.5517578f, 2.5517578f, 2.6826172f, 2.586914f, 2.8320312f, 2.8320312f, 2.9824219f, 2.9179688f, 3.1914062f, 3.1914062f, 3.366211f, 2.7373047f, 2.9628906f, 2.9628906f, 3.1083984f, 2.4121094f, 2.5859375f, 2.5859375f, 2.7041016f, 2.1757812f, 2.328125f, 2.328125f, 2.4033203f, 2.0078125f, 2.1455078f, 2.1455078f, 2.2080078f, 1.8525391f, 1.9697266f, 1.9697266f, 2.015625f, 1.703125f, 1.7900391f, 1.7900391f, 1.8222656f, 1.5820312f, 1.6572266f, 1.6572266f, 1.6962891f, 1.5068359f, 1.5771484f, 1.5771484f, 1.6035156f, 1.4833984f, 1.5517578f, 1.5517578f, 1.5898438f, 1.4970703f, 1.5742188f, 1.5742188f, 1.5996094f, 1.5585938f, 1.6435547f, 1.6435547f, 1.6845703f, 1.6669922f, 1.7753906f, 1.7753906f, 1.8251953f, 1.8095703f, 1.9257812f, 1.9257812f, 1.9970703f, 1.9482422f, 2.0898438f, 2.0898438f, 2.1708984f, 2.1210938f, 2.2910156f, 2.2910156f, 2.3789062f, 2.383789f, 2.586914f, 2.586914f, 2.6875f, 2.7558594f, 2.9375f, 2.9375f, 3.0371094f, 2.5410156f, 2.7197266f, 2.7197266f, 2.8291016f, 2.2460938f, 2.3945312f, 2.3945312f, 2.4658203f, 2.0664062f, 2.1757812f, 2.1757812f, 2.2441406f, 1.8554688f, 1.9736328f, 1.9736328f, 2.0107422f, 1.6679688f, 1.7470703f, 1.7470703f, 1.7705078f, 1.5087891f, 1.5751953f, 1.5751953f, 1.5957031f, 1.4072266f, 1.4619141f, 1.4619141f, 1.4677734f, 1.3417969f, 1.3964844f, 1.3964844f, 1.4082031f, 1.3232422f, 1.3779297f, 1.3779297f, 1.3857422f, 1.3349609f, 1.390625f, 1.390625f, 1.40625f, 1.3828125f, 1.4550781f, 1.4550781f, 1.4677734f, 1.4824219f, 1.5625f, 1.5625f, 1.5996094f, 1.6318359f, 1.7216797f, 1.7216797f, 1.7714844f, 1.8095703f, 1.9267578f, 1.9267578f, 1.9638672f, 1.9873047f, 2.1201172f, 2.1201172f, 2.1904297f, 2.2207031f, 2.3701172f, 2.3701172f, 2.4267578f, 2.5507812f, 2.7216797f, 2.7216797f, 2.8027344f, 2.4160156f, 2.538086f, 2.538086f, 2.6289062f, 2.1416016f, 2.2617188f, 2.2617188f, 2.303711f, 1.9599609f, 2.0517578f, 2.0517578f, 2.0771484f, 1.7304688f, 1.8095703f, 1.8095703f, 1.8203125f, 1.5068359f, 1.5761719f, 1.5761719f, 1.5878906f, 1.3808594f, 1.4208984f, 1.4208984f, 1.4121094f, 1.2890625f, 1.328125f, 1.328125f, 1.3271484f, 1.2333984f, 1.265625f, 1.265625f, 1.2607422f, 1.2158203f, 1.2480469f, 1.2480469f, 1.2392578f, 1.2324219f, 1.2714844f, 1.2714844f, 1.2646484f, 1.28125f, 1.328125f, 1.328125f, 1.3339844f, 1.3632812f, 1.4257812f, 1.4257812f, 1.4228516f, 1.4853516f, 1.5693359f, 1.5693359f, 1.5820312f, 1.6962891f, 1.7714844f, 1.7714844f, 1.7998047f, 1.890625f, 1.9902344f, 1.9902344f, 2.040039f, 2.1220703f, 2.227539f, 2.227539f, 2.2646484f, 2.368164f, 2.5839844f, 2.5839844f, 2.618164f, 2.2763672f, 2.4296875f, 2.4296875f, 2.491211f, 2.0732422f, 2.1953125f, 2.1953125f, 2.227539f, 1.8681641f, 1.9472656f, 1.9472656f, 1.9775391f, 1.6054688f, 1.6748047f, 1.6748047f, 1.6875f, 1.4267578f, 1.4648438f, 1.4648438f, 1.4619141f, 1.2978516f, 1.3339844f, 1.3339844f, 1.3183594f, 1.2099609f, 1.2333984f, 1.2333984f, 1.2167969f, 1.1455078f, 1.1679688f, 1.1679688f, 1.1464844f, 1.1171875f, 1.1376953f, 1.1376953f, 1.1162109f, 1.1455078f, 1.1708984f, 1.1708984f, 1.1474609f, 1.2089844f, 1.2402344f, 1.2402344f, 1.2167969f, 1.2919922f, 1.3369141f, 1.3369141f, 1.3261719f, 1.4189453f, 1.4628906f, 1.4628906f, 1.4580078f, 1.5888672f, 1.6611328f, 1.6611328f, 1.6572266f, 1.8183594f, 1.9072266f, 1.9072266f, 1.90625f, 2.0458984f, 2.149414f, 2.149414f, 2.1767578f, 2.290039f, 2.4199219f, 2.4199219f, 2.4550781f, 2.2509766f, 2.3789062f, 2.3789062f, 2.4814453f, 2.0273438f, 2.1376953f, 2.1376953f, 2.1875f, 1.7636719f, 1.8681641f, 1.8681641f, 1.9091797f, 1.5224609f, 1.6035156f, 1.6035156f, 1.6083984f, 1.359375f, 1.4033203f, 1.4033203f, 1.4023438f, 1.2529297f, 1.2753906f, 1.2753906f, 1.2578125f, 1.1494141f, 1.1679688f, 1.1679688f, 1.1416016f, 1.0732422f, 1.0888672f, 1.0888672f, 1.0605469f, 1.0507812f, 1.0585938f, 1.0585938f, 1.0263672f, 1.0712891f, 1.0888672f, 1.0888672f, 1.0576172f, 1.1503906f, 1.1728516f, 1.1728516f, 1.1513672f, 1.2382812f, 1.2763672f, 1.2763672f, 1.2558594f, 1.3564453f, 1.4072266f, 1.4072266f, 1.3925781f, 1.5214844f, 1.5917969f, 1.5917969f, 1.5791016f, 1.7519531f, 1.8310547f, 1.8310547f, 1.8583984f, 1.9873047f, 2.0908203f, 2.0908203f, 2.1123047f, 2.2158203f, 2.3623047f, 2.3623047f, 2.4072266f, 2.2441406f, 2.3730469f, 2.3730469f, 2.4326172f, 2.0185547f, 2.1289062f, 2.1289062f, 2.1621094f, 1.7685547f, 1.8515625f, 1.8515625f, 1.8847656f, 1.4980469f, 1.5751953f, 1.5751953f, 1.6083984f, 1.3447266f, 1.3876953f, 1.3876953f, 1.3837891f, 1.2197266f, 1.2509766f, 1.2509766f, 1.2304688f, 1.1259766f, 1.1376953f, 1.1376953f, 1.1191406f, 1.0507812f, 1.0595703f, 1.0595703f, 1.0292969f, 1.0253906f, 1.0361328f, 1.0361328f, 1.0009766f, 1.0449219f, 1.0634766f, 1.0634766f, 1.0351562f, 1.1152344f, 1.1484375f, 1.1484375f, 1.1289062f, 1.2265625f, 1.2568359f, 1.2568359f, 1.2431641f, 1.3339844f, 1.3886719f, 1.3886719f, 1.3798828f, 1.4990234f, 1.5605469f, 1.5605469f, 1.5566406f, 1.7304688f, 1.8212891f, 1.8212891f, 1.8398438f, 1.9638672f, 2.0791016f, 2.0791016f, 2.1201172f, 2.21875f, 2.3535156f, 2.3535156f, 2.3896484f, 2.2001953f, 2.3632812f, 2.3632812f, 2.4296875f, 2.0390625f, 2.1552734f, 2.1552734f, 2.2070312f, 1.7851562f, 1.875f, 1.875f, 1.9023438f, 1.5351562f, 1.6083984f, 1.6083984f, 1.6083984f, 1.3730469f, 1.4091797f, 1.4091797f, 1.4091797f, 1.2441406f, 1.2705078f, 1.2705078f, 1.2617188f, 1.1386719f, 1.1621094f, 1.1621094f, 1.1445312f, 1.0693359f, 1.0917969f, 1.0917969f, 1.0693359f, 1.046875f, 1.0664062f, 1.0664062f, 1.0449219f, 1.0703125f, 1.09375f, 1.09375f, 1.0800781f, 1.1376953f, 1.1757812f, 1.1757812f, 1.1650391f, 1.2333984f, 1.2792969f, 1.2792969f, 1.2783203f, 1.3486328f, 1.4013672f, 1.4013672f, 1.3984375f, 1.5205078f, 1.5908203f, 1.5908203f, 1.5917969f, 1.7568359f, 1.8388672f, 1.8388672f, 1.8457031f, 1.9863281f, 2.0917969f, 2.0917969f, 2.125f, 2.258789f, 2.3779297f, 2.3779297f, 2.4501953f, 2.2666016f, 2.421875f, 2.421875f, 2.53125f, 2.071289f, 2.1933594f, 2.1933594f, 2.2402344f, 1.8554688f, 1.9492188f, 1.9492188f, 1.9853516f, 1.6132812f, 1.6689453f, 1.6689453f, 1.6943359f, 1.4052734f, 1.46875f, 1.46875f, 1.4746094f, 1.2871094f, 1.3261719f, 1.3261719f, 1.3251953f, 1.1982422f, 1.2314453f, 1.2314453f, 1.2236328f, 1.1357422f, 1.1640625f, 1.1640625f, 1.1601562f, 1.1142578f, 1.140625f, 1.140625f, 1.1279297f, 1.1259766f, 1.1679688f, 1.1679688f, 1.1689453f, 1.1953125f, 1.2392578f, 1.2392578f, 1.2382812f, 1.2802734f, 1.3320312f, 1.3320312f, 1.3398438f, 1.3955078f, 1.4619141f, 1.4619141f, 1.4599609f, 1.5761719f, 1.6542969f, 1.6542969f, 1.6767578f, 1.8339844f, 1.9199219f, 1.9199219f, 1.9345703f, 2.0615234f, 2.1679688f, 2.1679688f, 2.211914f, 2.2753906f, 2.4472656f, 2.4472656f, 2.4853516f, 2.399414f, 2.538086f, 2.538086f, 2.6835938f, 2.1259766f, 2.2597656f, 2.2597656f, 2.3447266f, 1.9472656f, 2.0449219f, 2.0449219f, 2.1142578f, 1.6943359f, 1.796875f, 1.796875f, 1.8222656f, 1.5185547f, 1.5693359f, 1.5693359f, 1.59375f, 1.3701172f, 1.4238281f, 1.4238281f, 1.4238281f, 1.2792969f, 1.3251953f, 1.3251953f, 1.3261719f, 1.2226562f, 1.2646484f, 1.2646484f, 1.2705078f, 1.1972656f, 1.2470703f, 1.2470703f, 1.2519531f, 1.2167969f, 1.2666016f, 1.2666016f, 1.2783203f, 1.265625f, 1.3339844f, 1.3339844f, 1.3525391f, 1.3417969f, 1.4277344f, 1.4277344f, 1.4384766f, 1.4912109f, 1.5703125f, 1.5703125f, 1.5996094f, 1.6757812f, 1.7773438f, 1.7773438f, 1.8066406f, 1.9082031f, 2.0253906f, 2.0253906f, 2.0585938f, 2.125f, 2.25f, 2.25f, 2.3066406f, 2.4179688f, 2.5878906f, 2.5878906f, 2.6845703f, 2.5361328f, 2.71875f, 2.71875f, 2.9199219f, 2.2382812f, 2.390625f, 2.390625f, 2.5097656f, 2.040039f, 2.165039f, 2.165039f, 2.2363281f, 1.8496094f, 1.9580078f, 1.9580078f, 2.0341797f, 1.6728516f, 1.7480469f, 1.7480469f, 1.7714844f, 1.4970703f, 1.5742188f, 1.5742188f, 1.5849609f, 1.4111328f, 1.4619141f, 1.4619141f, 1.4589844f, 1.3378906f, 1.3964844f, 1.3964844f, 1.4042969f, 1.3134766f, 1.375f, 1.375f, 1.3769531f, 1.3300781f, 1.3964844f, 1.3964844f, 1.4160156f, 1.3740234f, 1.4619141f, 1.4619141f, 1.4775391f, 1.4853516f, 1.5712891f, 1.5712891f, 1.6064453f, 1.6230469f, 1.734375f, 1.734375f, 1.7841797f, 1.8095703f, 1.9287109f, 1.9287109f, 1.9765625f, 2.0175781f, 2.1455078f, 2.1455078f, 2.2080078f, 2.2324219f, 2.4023438f, 2.4023438f, 2.4853516f, 2.6054688f, 2.7871094f, 2.7871094f, 2.8759766f, 2.7314453f, 2.9003906f, 2.9003906f, 3.118164f, 2.4091797f, 2.5683594f, 2.5683594f, 2.711914f, 2.1679688f, 2.3105469f, 2.3105469f, 2.4189453f, 2.015625f, 2.1298828f, 2.1298828f, 2.1904297f, 1.8681641f, 1.9580078f, 1.9580078f, 1.9941406f, 1.7099609f, 1.7783203f, 1.7783203f, 1.7998047f, 1.5830078f, 1.6503906f, 1.6503906f, 1.6660156f, 1.5039062f, 1.5820312f, 1.5820312f, 1.5888672f, 1.4833984f, 1.5585938f, 1.5585938f, 1.5654297f, 1.4941406f, 1.5732422f, 1.5732422f, 1.59375f, 1.5576172f, 1.6513672f, 1.6513672f, 1.6796875f, 1.6533203f, 1.7695312f, 1.7695312f, 1.8173828f, 1.7988281f, 1.9355469f, 1.9355469f, 1.9941406f, 1.9609375f, 2.1083984f, 2.1083984f, 2.180664f, 2.1210938f, 2.3007812f, 2.3007812f, 2.4042969f, 2.4179688f, 2.6083984f, 2.6083984f, 2.7470703f, 2.6816406f, 2.9814453f, 2.9814453f, 3.163086f, 2.9941406f, 3.1445312f, 3.1445312f, 3.4296875f, 2.6054688f, 2.821289f, 2.821289f, 2.9990234f, 2.3378906f, 2.522461f, 2.522461f, 2.665039f, 2.1132812f, 2.2636719f, 2.2636719f, 2.3701172f, 2.0234375f, 2.1298828f, 2.1298828f, 2.2060547f, 1.9248047f, 2.0166016f, 2.0166016f, 2.0703125f, 1.796875f, 1.9228516f, 1.9228516f, 1.9414062f, 1.7216797f, 1.8183594f, 1.8183594f, 1.8505859f, 1.6777344f, 1.7861328f, 1.7861328f, 1.8212891f, 1.7070312f, 1.8212891f, 1.8212891f, 1.8632812f, 1.7568359f, 1.8730469f, 1.8730469f, 1.9160156f, 1.8681641f, 2.0058594f, 2.0058594f, 2.0800781f, 1.9511719f, 2.140625f, 2.140625f, 2.211914f, 2.1191406f, 2.2851562f, 2.2851562f, 2.4179688f, 2.3232422f, 2.5419922f, 2.5419922f, 2.7050781f, 2.5839844f, 2.8476562f, 2.8476562f, 2.9873047f, 2.9160156f, 3.2773438f, 3.2773438f, 3.4160156f,
            };
            sensor.gainMapSize = new int[] { 17, 13 };
        }
    }

    @Override
    void saturationCorrection(float[] saturationMap) {
        saturationMap[0] *= 1.4f;
        saturationMap[1] *= 1.4f;
        saturationMap[2] *= 1.5f;
        saturationMap[3] *= 1.2f;
        saturationMap[4] *= 1.1f;
        saturationMap[5] *= 1.2f;
        saturationMap[6] *= 1.3f;
        saturationMap[7] *= 1.4f;
    }
}
